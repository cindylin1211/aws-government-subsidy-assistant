<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æ¸¬è©¦å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            background: #FF9900;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #e68a00;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Bedrock Agent API æ¸¬è©¦å·¥å…·</h1>
    
    <div class="test-section">
        <h2>API é…ç½®</h2>
        <p><strong>API URL:</strong> <code id="apiUrl">https://hyeavzp56b.execute-api.us-west-2.amazonaws.com/prod/chat</code></p>
        <p><strong>Agent ID:</strong> Z56OAA2L3J</p>
        <p><strong>Agent Alias ID:</strong> Z1FEZNULZP</p>
    </div>

    <div class="test-section">
        <h2>æ¸¬è©¦ 1: åŸºæœ¬é€£ç·šæ¸¬è©¦</h2>
        <button onclick="testConnection()">æ¸¬è©¦é€£ç·š</button>
        <div id="connectionResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ¸¬è©¦ 2: ç™¼é€è¨Šæ¯</h2>
        <input type="text" id="testMessage" placeholder="è¼¸å…¥æ¸¬è©¦è¨Šæ¯..." value="ä½ å¥½ï¼Œè«‹å•å¦‚ä½•ç”³è«‹æ”¿åºœè£œåŠ©ï¼Ÿ">
        <button onclick="testMessage()">ç™¼é€è¨Šæ¯</button>
        <div id="messageResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ¸¬è©¦ 3: CORS æª¢æŸ¥</h2>
        <button onclick="testCORS()">æª¢æŸ¥ CORS</button>
        <div id="corsResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_URL = 'https://hyeavzp56b.execute-api.us-west-2.amazonaws.com/prod/chat';

        async function testConnection() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'test',
                        sessionId: 'test-session'
                    })
                });

                const data = await response.json();
                
                resultDiv.className = 'result ' + (response.ok ? 'success' : 'error');
                resultDiv.textContent = `ç‹€æ…‹ç¢¼: ${response.status}\n\n` +
                    `å›æ‡‰:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `éŒ¯èª¤: ${error.message}\n\n` +
                    `é€™å¯èƒ½æ˜¯ CORS å•é¡Œæˆ–ç¶²è·¯é€£ç·šå•é¡Œã€‚\n` +
                    `è«‹æª¢æŸ¥:\n` +
                    `1. Lambda å‡½æ•¸æ˜¯å¦æ­£ç¢ºéƒ¨ç½²\n` +
                    `2. API Gateway æ˜¯å¦å•Ÿç”¨ CORS\n` +
                    `3. Lambda å‡½æ•¸çš„ IAM æ¬Šé™`;
            }
        }

        async function testMessage() {
            const message = document.getElementById('testMessage').value;
            const resultDiv = document.getElementById('messageResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'ç™¼é€ä¸­...';

            try {
                console.log('ç™¼é€è¨Šæ¯:', message);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        sessionId: `test-${Date.now()}`
                    })
                });

                console.log('å›æ‡‰ç‹€æ…‹:', response.status);
                
                const data = await response.json();
                console.log('å›æ‡‰è³‡æ–™:', data);
                
                resultDiv.className = 'result ' + (response.ok ? 'success' : 'error');
                resultDiv.textContent = `ç‹€æ…‹ç¢¼: ${response.status}\n\n` +
                    `Agent å›æ‡‰:\n${data.response || data.error || 'ç„¡å›æ‡‰'}\n\n` +
                    `å®Œæ•´è³‡æ–™:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                console.error('éŒ¯èª¤:', error);
                resultDiv.className = 'result error';
                resultDiv.textContent = `éŒ¯èª¤: ${error.message}`;
            }
        }

        async function testCORS() {
            const resultDiv = document.getElementById('corsResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'æª¢æŸ¥ä¸­...';

            try {
                const response = await fetch(API_URL, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });

                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });

                resultDiv.className = 'result success';
                resultDiv.textContent = `CORS æª¢æŸ¥çµæœ:\n\n` +
                    `ç‹€æ…‹ç¢¼: ${response.status}\n\n` +
                    `CORS æ¨™é ­:\n${JSON.stringify(headers, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `CORS éŒ¯èª¤: ${error.message}\n\n` +
                    `è«‹ç¢ºèª API Gateway å·²å•Ÿç”¨ CORS`;
            }
        }
    </script>
</body>
</html>